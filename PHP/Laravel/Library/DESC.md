# Проект "Реестр книг"

<p>
    Тестовое задание "Реестр книг" на фреймворке Laravel. Версия лавы 10. Это вообще мой первый сайт на php. Можно сказать что я одновременно изучал и php и Laravel. Тогда я думал что у меня хорошо получилось, а сейчас смотрю на код, аж стыдно его кидать))
</p>

<h2>Задачи для проекта (то что помню):</h2>
<ul>
    <li>
        Пользователь должен иметь возможность авторизации и регистрации. Причём есть 3 типа пользователей. Первый: обычный пользователь. Второй: издатель. Третий: администратор. У издателя есть возможность публиковать книги.
    </li>
    <li>
        Администратор имеет возможность редактировать/удалять книги, и акаунты пользователей. (Тут я почему то сделал для администратора одельную авторизацию. Хотя можно было сделать авторизацию админа, при авторизации пользователя. Всё равно работа с одними и теми же данными. Т.е. нет одтельной таблицы с админами или что то такое. Не помню уже зачем.)
    </li>
    <li>
        Во время публикации книги должна быть возможность указать: название, автора, жанр, тип издания (Печатное, Графическое, Электронное) и описание. А так же возможность установить обложку этой книги. (картинка)
    </li>

</ul>

<p>Там конечно было болше пунктов и описаны они были подробнее, но это всё что я помню.</p>

<h2>Сейчас чисто по интерестным моментам:</h2>
<p>
    Контролерры я делал для каждой модели. По две штуки. Первый файл для предоставления в web. Второй чисто api взаимодействие. Но для книг я добавил ещё 2 котролерра. Мне нужно было возвращять книги по авторам и по жанрам. Поясню на примере UserController.php и UserActionController.php. В первом все функции возвращяют исключительно страницы. К ним могут быть прекрепленны какие-то данные. Например функция index:
</p>

```php
public function index($id) {
    $user = User::findOrFail($id);
    if ($user->user_type == UserTypeEnum::Publisher->value) {
        $books = SortController::PersonalBookSort($user->login);
    } else {
        $books = null;
    }
    return view('views/web/users/user', ['user' => $user, 'books' => $books]);
}
```

<p>
    Она возвращяет профиль пользователя с определённым id. Если пользователь является издателем, то также в его профиле будут отображатсья опубликованные им книги.
</p>

<p>
    В файле UserActionController.php функции, после своего исполнения, редиректят по уже существующим маршрутам. И так во всех (model_name)ActionController.php
</p>

```php
public function store(UserRequest $request) {
    $data = $request->validated();
    $user = User::create($data);
    if($user) {
        auth('web')->login($user);
        unset($data['password']);
        $this->logs->store_log(ObjectTypeEnum::User, $user->id, $data, 'Регестрация');
    }
    return redirect(route('users.lk'));
}
```

<p>
    Я так делал потому что пытался работать по стандартам, которые были прописаны в команде у того знакомого, который мне дал это задание.
</p>

<p>
    Кстати логи я тогда посчитал хорошей идеей сувать в базу данных. Не понимаю зачем я это делал, с учётом того что в этих логах мало полезной информации, да и к тому же в лаве есть встроенная система логирования. Но только я пробовал!))
</p>
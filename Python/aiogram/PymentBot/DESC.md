# Проект "Бот для олаты"

<p>
    Это мой первый проект за который я получил деньги. Делал я его с помощью ChatGPT. Так что в коде есть не мало коментариев от него. По совместительству это мой первый проект телеграм бота. До этого я ботов вообще не делал. Это я к тому что могу адаптироваться и резко в моменте что то изучить для работы) Пологаю это плюс.
</p>

<h2>О бд:</h2>

<p>
    В этом проекте лишь две таблицы. Users и Payments. Так что запросы довольно типовые. Они прописаны <a href="https://github.com/Bat0nbl4/Scripts/blob/main/Python/aiogram/PymentBot/db.py">в этом фале</a>
</p>

<h2>Базовый сценарий работы бота: </h2>
<ul>
    <li>
        Пользователь заходит в бота.
    </li>
    <li>
        Если пользователь не найден то бот его добавляет в бд.

```py
async def add_user_if_not_exists(user_id: int, username: str):
    """Добавляет нового пользователя в БД, если он ещё не существует"""
    await ensure_db_pool()
    async with db_pool.acquire() as conn:
        async with conn.cursor() as cur:
            # Проверяем, есть ли пользователь в БД
            await cur.execute("SELECT COUNT(*) FROM users WHERE user_id = %s", (user_id,))
            result = await cur.fetchone()

            if result[0] == 0:  # Если пользователя нет, добавляем его
                await cur.execute("""
                    INSERT INTO users (user_id, username, subscription_end, status)
                    VALUES (%s, %s, NULL, NULL)
                """, (user_id, username))
                logging.info(f"✅ Новый пользователь добавлен: {user_id} ({username})")
                return True
            return False
```

    </li>
    <li>
        Пользователь выбирает тариф и сеть для оплаты (оплата по реквизитам, криптовалютой USDT)
    </li>
    <li>
        Олпачивает*
    </li>
    <li>
        Отправляет боту хеш код транзакции сообщением.
    </li>
    <li>
        Данные об оплате сохраняются в бд (Кто полачиват, какой тариф, через какую сеть, хеш код транзакции и т.д.)
    </li>
    <li>
        Сообщение об олпате рассылается всем администраторам. Всё так же через этого же бота.
    </li>
    <li>
        Администратор принимат или оклонят платёж. Если отклоняет то обязательно вводит коментарий, который прикрепляется к этому платежу.
    </li>
    <li>
        Пользователь получает сообщение о том что его платёж принят или не принят. Если плётж не был принят то так же выводиться коментарий администратора.
    </li>
</ul>

<p>
    Всё это происходит непосредственно через бота, без всяких стороних программ. 
</p>

<p>
    По мимо описанного выше функционала, есть так же возможности задать вопрос админитраторам ( только 2 вопроса в день от пользователя), продлить подписку. Администратор может прямо в бота вывести список пользователей. Я ещё работаю над ботом, заказчик хочет расширять функционал.
</p>